Sub xxx_stock_market()


' Set variable for ticker symbol
Dim ticker_symbol As String
  
'set variable for total stock volume
Dim total_stock_volume As Double
total_stock_volume = 0




'insert column headings for the summary table
Cells(1, 9).Value = "Ticker"
Cells(1, 10).Value = "Yearly Change"
Cells(1, 11).Value = "Percent Change"
Cells(1, 12).Value = "Total Stock Volume"

'yearly change = close value - open value
'percent change = ((close value - open value) / open value)*100
'set variables for those
Dim yearly_change As Double
Dim close_value As Double
Dim open_value As Double
Dim percent_change As Double

'set open value
open_value = Cells(2, 3).Value






'keep track of the location for each ticker symbol in the summary table
Dim summary_table_row As Integer
summary_table_row = 2

'set a counter for last row of the data
last_row = Cells(Rows.Count, 1).End(xlUp).Row

    'loop through all stock in this worksheet
 For i = 2 To last_row

    'check if we are still within the same ticker, if it is not the same then...
    If Cells(i + 1, 1).Value <> Cells(i, 1).Value Then
    
   'set the ticker symbol
    ticker_symbol = Cells(i, 1).Value
    
    'print ticker symbol in summary table
    Range("I" & summary_table_row).Value = ticker_symbol
    
    'add to the total stock volume
    total_stock_volume = total_stock_volume + Cells(i, 7).Value
    
    'print total stock volume in summary table
    Range("L" & summary_table_row).Value = total_stock_volume
    
 
 
    
    'set close value
    close_value = Cells(i, 6).Value
    
    'formula to calculate yearly change
    yearly_change = close_value - open_value

    'print yearly change in summary table column J
    Range("J" & summary_table_row).Value = yearly_change
   
   
    
    
    'problem with percent change formula when the open price value is zero
    'if the open price is zero then
    If open_value = 0 Then
    
        'set percent change as zeo
        percent_change = 0
        
        'if open price isn't zero then
        Else
        
        'formula to calculate percent change
        percent_change = ((close_value - open_value) / open_value) * 100
    
        'rounding down to 2 decimal place
        percent_change = Application.WorksheetFunction.RoundDown(percent_change, 2)
    
        'print the percent change in summary table column K
        Range("K" & summary_table_row).Value = percent_change
    
    End If

   
   
   'add 1 to the summary table row
    summary_table_row = summary_table_row + 1
    
    'reset total stock volume
    total_stock_volume = 0
    
    'reset opening value as I set this outside of the loop, unlike closing value
    open_value = Cells(i + 1, 3)
    
   

'if the cell immediately following a row has the same ticker...
  Else

  'add to the total volume of stock
  total_stock_voume = total_stock_volume + Cells(i, 7).Value
    
 End If


Next i

End Sub

